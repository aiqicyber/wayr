<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Profile — WAYR</title>
  <script src="https://unpkg.com/localbase/dist/localbase.dev.js"></script>

<style>
    /*fontstack DONT CHANGE DUMBASS*/
    :root{
      --max-width: 920px;
      --accent-radius: 8px;
      --muted: #666;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: "Lucida Grande","Lucida Sans Unicode", "Lucida Sans", Geneva, Verdana, sans-serif;
      color:#0b0b0b;
      background:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }

    /*PAGE CONTAINER ALR HAVE MARGIN JANGAN TAMBAH*/
    .wrap{
      max-width:var(--max-width);
      margin: 48px auto;
      padding: 0 28px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:36px;
    }

    .logo {
     font-weight: 700;
     font-size: 20px;
      letter-spacing: 1px;
      text-decoration: none;   
      color: inherit;          
      display: inline-block;   
      cursor: pointer;         
    }

    .logo:hover {
     text-decoration: underline;
    }

    nav{
      display:flex;
      gap:20px;
      align-items:center;
      font-size:14px;
    }

    nav a{
      color:#111;
      text-decoration:none;
      opacity:0.9;
    }

    .btn-ghost{
      border-radius:10px;
      border:none;
      padding:10px 14px;
      font-size:20px;
      cursor:pointer;
      background:#000;
      color:#fff;
      box-shadow: none;
    }

    .hero{
      display:flex;
      gap:40px;
      align-items:flex-start;
      margin-top:18px;
      margin-bottom:56px;
    }

    .hero-left{
      flex:1;
    }

    h1{
      font-size:48px;
      margin:0 0 18px 0;
      line-height:1.02;
      font-weight:800;
    }

    .lead{
      color:var(--muted);
      max-width:620px;
      margin:0 0 22px 0;
      font-size:15px;
    }

    .create-btn{
      display:inline-block;
      padding:12px 28px;
      background:#000;
      color:#fff;
      text-decoration:none;
      border-radius:8px;
      font-weight:600;
      letter-spacing:0.2px;
    }
    h1 {
      font-size: 36px;
      margin-bottom: 8px;
    }

    p {
      color: var(--muted);
      max-width: 500px;
      line-height: 1.5;
      margin-bottom: 30px;
    }

    .input-box {
      margin-bottom: 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .hint-text {
      margin: 0 0 6px 0 !important;
      margin-top: 6px;
      margin-bottom: 4px; 
      font-size: 15px;
      color: #000;
    }

    label {
      font-size: 15px;
      margin-bottom: 6px;
    }

    input[type="text"] {
      padding: 8px 10px;
      font-size: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
      width: 260px;
      outline: none;
    }

    input[type="text"]:focus {
      border-color: #000;
    }

    canvas {
     display: block;
     border: 2px solid #555;
     border-radius: 10px;
      background-color: #fff;
     cursor: crosshair;
     margin-bottom: 20px;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    button {
      background-color: #000;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background-color: #333;
    }

    #savedMsg {
    margin-top: 14px;
    color: #1a7f37;
    font-weight: 600;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
  }


    .reflection {
      margin-top: 40px;
    }

    .reflection h2 {
      font-size: 18px;
      margin: 28px 0 6px;
      font-weight: 700;
    }

    .question-text {
      margin: 0 0 8px 0;
      color: #000;
      max-width: 600px;
    }

    textarea {
      width: 100%;
      max-width: 600px;
      min-height: 110px;
      padding: 10px;
      font-size: 15px;
      font-family: inherit;
      border-radius: 8px;
      border: 1px solid #ccc;
      resize: vertical;
    }

    textarea:focus {
      outline: none;
      border-color: #000;
    }

    /* SLIDER question */
    .slider-block {
      margin-top: 36px;
      max-width: 600px;
    }

    .slider-labels {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    input[type="range"] {
      width: 100%;
      appearance: none;
      height: 4px;
      background: #ddd;
      border-radius: 4px;
      outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #000;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #000;
      cursor: pointer;
    }

    .slider-value {
      margin-top: 6px;
      font-size: 14px;
      color: #000;
    }

    @media (max-width: 700px) {
      h1 { font-size: 28px; }
      nav { gap: 12px; }
    }
    a:focus, button:focus { outline: 3px solid rgba(0,0,0,0.08); outline-offset:3px; }

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a class="logo" href="home.html">WAYR</a>
      <nav aria-label="Main navigation">
        <a class="btn-ghost" href="you.html">You!</a>
      </nav>
    </header>

    <main>
      <h1>Who are you now?</h1>
      <p>Look in the mirror; into your eyes, the window to your soul, and answer these questions. </p>

      <div class="input-box">
        <label for="nameInput">You need a name. What's your name? </label>
        <input type="text" id="nameInput" placeholder=""Hey,()!"" />
        <p></p>
        <p class="hint-text">Draw the lines of your face.</p>
      </div>
      <canvas id="drawBox" width="400" height="300"></canvas>

      <div class="controls">
        <button id="clearBtn">Clear</button>
      </div>
      <section class="reflection">
      <h2>Identity</h2>
      <p id="identity-question" class="question-text"></p>
     <textarea id="identity-answer" placeholder="Write here..."></textarea>

      <h2>Growth</h2>
     <p id="growth-question" class="question-text"></p>
     <textarea id="growth-answer" placeholder="Write here..."></textarea>

     <h2>Honesty</h2>
     <p id="honesty-question" class="question-text"></p>
     <textarea id="honesty-answer" placeholder="Write here..."></textarea>
    
    <div class="slider-block">
      <h2>Perspective</h2>

      <p class="question-text">
        Where are you now?
      </p>

      <div class="slider-labels">
        <span>Clarity & Stability</span>
        <span>Ambiguity & Change</span>
      </div>

      <input
        type="range"
        id="perspective-slider"
        min="0"
        max="100"
        value="50"
      />
      <div id="sliderValue" class="slider-value">
      </div>
    </div>
    </section>

      <p id="savedMsg">Got it!</p>
    </main>
  </div>
  <div class="controls" style="max-width:920px; margin: 0 auto 48px auto;">
    <button id="saveBtn">Save and Record in You archives</button>
  </div>
  
 <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.min.js"></script>

  

  <script>
  let archivePassword = localStorage.getItem('archivePassword')

  if (!archivePassword) {
    const pw = prompt('Create a password to lock your archive:')
    if (!pw) {
      alert('Password required to continue.')
      throw new Error('No password set')
    }
    archivePassword = pw
    localStorage.setItem('archivePassword', pw)
  }

    let db=new Localbase('db');
    const identityQs=[
  "What are some things people label you that you don’t really agree with, and why?",
  "What values matter to you the most?",
  "What’s something you’ve outgrown or let go of, even if it used to define you?"
];
    const growthQs=[
  "How would you describe the person you want to become?",
  "What’s a moment where you realized you’ve grown, changed, even a little?",
  "What’s a choice you made that shaped you more than you expected?"
];
    const honestyQs=[
  "What’s a fear you’ve learned how to live with?",
  "When was the last time you surprised yourself?",
  "What’s something you’re okay being bad at for now?",
  "What’s something you’re allowing yourself to want?"
];
    function pickRandom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}
    const identityQuestion=pickRandom(identityQs);
    const growthQuestion=pickRandom(growthQs);
    const honestyQuestion=pickRandom(honestyQs);

    const canvas=document.getElementById('drawBox');
    const ctx=canvas.getContext('2d');
    const clearBtn=document.getElementById('clearBtn');
    const saveBtn=document.getElementById('saveBtn');
    const nameInput=document.getElementById('nameInput');
    const savedMsg=document.getElementById('savedMsg');
    const slider = document.getElementById('perspective-slider')
    const sliderValue = document.getElementById('sliderValue')

    function updateSliderLabel(val) {
      if (val < 35) return 'Leaning toward clarity & stability'
      if (val > 65) return 'Comfortable with ambiguity & change'
      return 'Middle ground'
    }

slider.addEventListener('input', () => {
      sliderValue.textContent = updateSliderLabel(slider.value)
    })

    document.getElementById("identity-question").textContent=identityQuestion;
    document.getElementById("growth-question").textContent=growthQuestion;
    document.getElementById("honesty-question").textContent=honestyQuestion;


    let drawing=false;

    canvas.addEventListener('mousedown', (e)=> {
      drawing=true;
      ctx.beginPath();
      ctx.moveTo(e.offsetX, e.offsetY);
    });

    canvas.addEventListener('mousemove', (e)=> {
      if (drawing) {
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.strokeStyle='#000';
        ctx.lineWidth=2;
        ctx.lineCap='round';
        ctx.stroke();
      }
    });

    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mouseleave', () => drawing = false);

    clearBtn.addEventListener('click', () => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    saveBtn.addEventListener('click', async () => {
      const perspectiveValue = slider.value;
      const identityAnswer = document.getElementById('identity-answer').value;
      const growthAnswer = document.getElementById('growth-answer').value;
      const honestyAnswer = document.getElementById('honesty-answer').value;
      const name = nameInput.value.trim();

      if (!name) {
        alert('Please enter your name.');
        return;
      }

      const reflections = {
        identity: { question: identityQuestion, answer: identityAnswer },
        growth: { question: growthQuestion, answer: growthAnswer },
        honesty: { question: honestyQuestion, answer: honestyAnswer }
      };

      const drawingData = canvas.toDataURL();

      const encryptedPayload = encryptData({
        id: Date.now(),
        name,
        drawing: drawingData,
        reflections,
        perspective: { value: perspectiveValue }
      }, archivePassword);

      await db.collection('users').add({
        id: Date.now(),
        payload: encryptedPayload
      });

      nameInput.value = '';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('identity-answer').value = '';
      document.getElementById('growth-answer').value = '';
      document.getElementById('honesty-answer').value = '';

      slider.value = 50;
      sliderValue.textContent = 'Middle ground';

      savedMsg.style.display = 'block';
      requestAnimationFrame(() => {
        savedMsg.style.opacity = '1';
      });

      setTimeout(() => {
        savedMsg.style.opacity = '0';
        setTimeout(() => {
          savedMsg.style.display = 'none';
        }, 300);
      }, 2000);
    });


      nameInput.value = '';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      document.getElementById('identity-answer').value = '';
      document.getElementById('growth-answer').value = '';
      document.getElementById('honesty-answer').value = '';


      savedMsg.style.display='block';
      setTimeout(()=> savedMsg.style.display = 'none', 3000);

      nameInput.value='';
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      slider.value = 50;
      sliderValue.textContent = 'Middle ground';


    function encryptData(data, password) {
    return CryptoJS.AES.encrypt(
      JSON.stringify(data),
      password
    ).toString()
  }
  </script>
</body>
</html>
